新教学环境的搭建
clone- vm7
调用 脚本进行虚拟机的创建
ROOT
password 123456
真机管理虚拟机
1.直接管理 无需ip 显示开机过程
             虚拟机的名字
virsh console  A


作用:只用来配置IP

退出 : ctrl + ]
2.配置 ip
虚拟机 A
 192.168.4.7/24
 主机名 svr7.tedu.cn

虚拟机 B
 192.168.4.207/24
 主机名 pc207.tedu.cn

添加别名只对 student 生效
[student@student ~]$ vim /home/student/.bashrc
    alias goa='ssh -X root@192.168.4.7'

    alias gob='ssh -X root@192.168.4.207'

查看虚拟机文件内容
[root@pc207 ~]# cat /etc/motd
为虚拟机搭建yum
服务端 :构建 web / ftp服务 共享仓库内容
在真机上安装 vsftpd
    [student@room9pc01 ~]$ rpm -q vsftpd
    vsftpd-3.0.2-22.el7.x86_64
    1. 查看服务状态
        [student@room9pc01 ~]$ systemctl status vsftpd
        ● vsftpd.service - Vsftpd ftp daemon
    2.  创建 /var/ftp/centos-1804
        /var/ftp/ 默认共享位置
        开机自动挂载
        mount -a 检测
        vim /etc/fstab
                                                                          光盘文件系统
        /var/lib/libvirt/images/iso/CentOS7-1804.iso  /var/ftp/centos-1804 iso9660 defaults 0 0

        检测
        [student@room9pc01 ~]$ firefox ftp://192.168.4.254
        A B 都要执行上面操作
常见的一级目录以及用法
        /boot  系统引导必须项目
        /bin /sbin  命令程序文件
        /etc   系统配置文件
        /dev  物理设备
        /root  /home
        /var  经常变化文件  日志文件
        /proc 存放内存中的映射数据,不占用磁盘空间
        /tmp  零时文件   ~]$ ls -ld /tmp/
                            drwxrwxrwt. 29 root root 4096 4月  19 11:32 /tmp/
权限数值的表示
        r = 4
        w = 2
        x = 1
        SUID = 4
        SGID = 2
        Sticky Bite = 1
        注意这里数字 是数字 不能和 字母连用 是能数字与数字 字母与字母

        [student@room9pc01 ~]$ chmod o+7 /etc/
        chmod: 无效模式："o+7"
        设置特殊权限
        第一个数字是附加权限的求和
        [root@svr7 ~]# chmod 7751 /public/ (大规模修改用,精确修改还的用字母)
        [root@svr7 ~]# ls -ld /public/
        drwsr-s--t 2 root root 6 4月  19 11:40 /public/
        [root@svr7 ~]#
        history -c 清空历史命令
        vim /etc/profile
        默认1k行
        !str  (常用)
        !xxx
        执行历史命令中最近以str开头的命令
          vim /etc/profile
          [root@svr7 ~]# systemctl restart httpd
          [root@svr7 ~]# !sys
          systemctl restart httpd
统计文件或者目录信息
         du

        [root@svr7 ~]# du -sh /root/
        13M	/root/
date查看/调整系统 时间  #####常常充当变量用
        date %F  显示Y- M -D
        date +%Y  只显示年
        date +%m 只显示月
        date +%d  只显示日
        date +%H  只显示小时
        date +%M  只显示分钟
        date +%S  只显示秒
软硬链接  ------制作快捷方式
    1.软连接(最多)
        ln -s /路径/软文件  /路径/快捷方式 (青色)
                  当你不起名字时候默认和源文件名相同
                  原始文件被干掉后软链接不可用
                  可以夸分区
        [root@svr7 ~]# mkdir /public/
        [root@svr7 ~]# ln -s /public/ /root/zz
        [root@svr7 ~]# ls
        Desktop  zz

    2.硬连接  (限制比较大)

        ln  /路径/软文件  /路径/快捷方式 (原始文件被干掉后硬链接依然可用)
        并且不可已跨分区使用,不能用在目录上
获取帮助
    1.利用help
        xxx --help
    2.权威帮助信息
        man  xxx
        mna 5 passwd ###5 表示文字帮助信息
        man 默认查看命令帮助信息
ZIP 归档工具,具有夸平台压缩归档格式
        zip [-r] 备份文件.zip  被归档文件    -r 递归  目录必须加

   释放zip
        unzip 备份文件.zip [-d] 目标文件夹   -d 指定目录,目录不从在会自动创建
将 ftp 上rhce测试脚本
        desktop0.sh  rht-labcheck  server0.sh
下载到/home/student/bin
        运行 rht-labcheck 进行检查

自定义yum 仓库
      1.将ftp中 tools.tar.gz下载到真机桌面
      2.将真机的tools.tar.gz上传到虚拟机A的root下
         scp依赖于ssh
         scp /本地路经/源文件  root@对方ip:/对方路径
      3.生产仓库数据文件
         yum -y install createrepo
         createrepo /tools/other/
      4.修改yum配置文件
         vim /etc/yum.repos.d/local.repo
         [A-repo]
         name=other
         baseurl=file:///tools/other
         enabled=1
         gpgcheck=0
      5. 显示安装路径
         rpm -ql XXX
         rpm -ql cmatrix


      在命令后面加上 & 将 程序放入后台

vim 编辑技巧
    vi :linux基本的文本编辑器
    依然和vim一样有三个模式
    命令模式
    12G 跳转到第12行
    GG 末尾
    gg开头
    yy复制
    p复制
    dd删除当前行
    d$ 或者 D 从光标处删除到行尾
    C 从光标处删除到行尾,进入插入模式
    d^ 从光标处删除到行首
    u 撤销
    U 撤销当前行所有操作
    ctrl + r 取消前一次撤销操作 (反撤销)
    shift + ZZ   保存且退出(命令模式)
    / 查询
   末行 模式
   :w
   :q!
   :W /root/newfile
   :set nu 显示行号
   :r /xxx/xxx  在当前行插入文件
   字符串的替换
   :%s/old/new/g  替换文件所有的 old
   :s /old/new/g  替换光标当前行所有old
   :s /old/new/   替换光标所在行的第一个 old
   :1,10 s/old/new/g   替换第1-10行所在行所有old
   开关参数的控制
   :set nu或nonu
   :set ai或noai 自动缩进
###################################################


Linux 安装  nfs-3g

mount.nfs-3g  /dev/xxxx  /挂载点/
##################################

kvm 虚拟化

概述 :
virtualization 资源管理

kvm构建以及管理

虚拟化软件
vmware
virtualpc Hyper-v(MICROSOFT)
KVM RHEV (REDHAT)
XEN  (CITRIX)
ORACLe VM VIRTUAALBOX (ORACLE)

安装 kvm 所需要的软件包

– qemu-kvm	:为 kvm 提供底层仿真支持
– libvirt-daemon	:libvirtd 守护进程,管理虚拟机
– libvirt-client	:用户端软件,提供客户端管理命令
– libvirt-daemon-driver-qemu	:libvirtd 连接 qemu 的驱动
– virt-manager	:图形管理工具

 systemctl restart libvirted
 systemctl enable libvirtd

 LANG=en virt-manager  ##启动服务

需要cpu支出虚拟化功能
在bios中开启 虚拟化功能

如何管理kvm

virt-manager

virsh 控制工具
  virsh console  虚拟机名字 ###真机直接管理虚拟机 不需要IP
  virsh nodeinfo          ####查看kvm节点信息
  virsh list(--all)              ####列出虚拟机
  virsh net-list(--all)   ##列出虚拟网络
  virsh dominfo   虚拟机名字        ###查看指定虚拟机的信息
  virsh autostart  虚拟机名字  ###将虚拟机设置为开机自启
  virsh autostart --disable  虚拟机名字 ###将虚拟机开机自启取消
  virsh start|reboot|shutdown  虚拟机名字 ###
  virsh destroy   虚拟机名字 ###强制关闭
一台虚拟机的构成
    xml 配置文件 (虚拟机配置文件) :定义虚拟机的名称 UUID CPU 内存
 磁盘 网卡 等 参数信息
    磁盘镜像文件 :保存 虚拟机的操作系统以及文档信息   路径取决于 xml文件定义
    存放 xml文件  /etc/libvirt/qemu
    在本机中 文件默认存放于 /var/lib/libvirt/images/
    导出xml配置文件
       查看 vrish dumpxml  虚拟机名称
       备份 virsh dumpxml  虚拟机名 > 虚拟机名.xml
       虚拟机名称 ,UUID  虚拟机磁盘文件路径 网卡MAC 地址
 ###########################################
  新建一个虚拟机
  nsd01 2g 内存 网络 private 1  9g disk  网络类型 private 1  最小化安装 自动分区 root 密码 1
 #############################################
  利用虚拟机nsd01作为模板,复制一份手动生产全新虚拟机 nsd2
  1.将虚拟机磁盘文件复制一份修改磁盘文件名称
  /var/lib/libvirt/images/
  [root@room9pc01 images]# cp nsd01.qcow2 nsd02.qcow2
   df -h 查看文件大小
  2.将nsd01的xml文件复制,修改 磁盘文件的位置
    [root@room9pc01 qemu]# virsh dumpxml nsd01  > /xmlfire/nsd02.xml
    [root@room9pc01 qemu]# vim /xmlfire/nsd02.xml
    生成uuid ,将原本的UUID替换
    uuidgen
    修改磁盘文件 位置
    <source file='/var/lib/libvirt/images/nsd02.qcow2'/>
    修改mac地址 ,删除 ,删除后\kvm会自己生成
    <mac address='56:54:00:98:05:e6'/>
  3.导入虚拟机信息
    [root@room9pc01 qemu]# virsh define /xmlfire/nsd02.xml
    定义域 nsd02（从 /xmlfire/nsd02
    启动管理软件
    [root@room9pc01 qemu]# virt-manager
  4.删除命令
    vrish undefine nsd02  ###只是删除 /etc/libvirt/qemu 下的 xml删除了 ,
    [root@room9pc01 qemu]# ls /etc/libvirt/qemu
    1.txt      B.xml          desktop.xml  nsd01.xml
    autostart  classroom.xml  D.xml        server.xml
    A.xml      C.xml          networks     win2008.xml

  使用 virsh edit xxx  可以达到  修改 复制xml 导入 这三条命令  除了复制磁盘文件 (命令行常用,但是脚本中用不到)

cow(写时复制)技术(快速克隆虚拟机关键技术) (也是docker技术的关键)
 copy on write
 特点:
     直接映射原始盘的数据内容
     当原始盘的旧数据有修改时,在修改之前自动将旧数据存入前端盘
     对前端盘的修改写不到原始盘
     前端盘在生成的时候 其实是一对快捷方式 (可能是软连接 ?)
快速创建qcow文件
     qemu-img 通过 -b 选项复用指定原始盘  -f 指定文件类型(qcow2 / rar )
     qemu-img create 磁盘文件 #快速产生一个任意大小的磁盘文件,内容为空
     qemu-img info 磁盘文件  ##查看磁盘文件信息
     qemu-img  create -f qcow2 -d /var/lib/libvirt/images/nsd01.qcow2 /var/lib/libvirt/images/nsd06.qcow2  10G
     qemu-img create  -f  文件类型 -d 原始盘 前端盘 前端盘大小
###############################
    1.以nsd01通过写实复制技术产生虚拟机前端盘
      images]# qemu-img create -f qcow2 -b /var/lib/libvirt/images/nsd01.qcow2 /var/lib/libvirt/images/nsd06.qcow2 10G
    2.产生并修改xml文件
     virsh edit xxx.xml
    3.开机
     virsh start xxx
配置虚拟机系统
    离线访问虚拟机磁盘文件内容
    guestmount -a 虚拟机磁盘路径 -i /挂载节点

##########################
教学环境(在虚拟机上用 )  扩展空间当虚拟机磁盘不够用时
LANG=en growpart /dev/vda 1  ##扩展/dev/vda 的第一个分区空间
lsblk
blkid /dev/vda1  ###扩展/dev/vda1 文件系统
df -h


